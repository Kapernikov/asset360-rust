# Repository Guidelines

## Project Structure & Module Organization
- `src/metamodel` (`linkml_meta`): Autogenerated metamodel types; optional Serde/PyO3.
- `src/schemaview` (`schemaview`/`linkml_schemaview`): Schema loading/resolution and views (SchemaView, ClassView, SlotView, EnumView).
- `src/runtime` (`linkml_runtime`): Core runtime (LinkMLValue parse/validate, diff/patch, turtle). Pure Rust lib.
- `src/tools` (`linkml_tools`): CLI binaries: `linkml-validate`, `linkml-convert`, `linkml-diff`, `linkml-patch`, `linkml-schema-validate`.
- `src/python` (`linkml_runtime_python`): PyO3 bindings and Python package `linkml_runtime_rust._native` plus helpers.
- `src/wasm` (`linkml_wasm`): WASM build target.

## Build, Test, and Development Commands
- Build workspace: `cargo build --workspace`
- Run all tests: `cargo test --workspace`
- Format (check): `cargo fmt --all -- --check` | Fix: `cargo fmt --all`
 - Lint: `cargo clippy --all-targets --all-features -- -D warnings --no-deps`
   - Note: This repo is a single crate (`asset360-rust`) that depends on the LinkML crates via Git. The per-package clippy invocation for the upstream multi-crate workspace does not apply here; lint this crate directly.
- Run a CLI (example):
  - Validate: `cargo run -p linkml_tools --bin linkml-validate -- src/runtime/tests/data/schema.yaml Person src/runtime/tests/data/person_valid.yaml`
  - Convert to TTL: `cargo run -p linkml_tools --bin linkml-convert -- src/runtime/tests/data/schema.yaml src/runtime/tests/data/example_personinfo_data.yaml --class Person --output out.ttl`
  - Diff: `cargo run -p linkml_tools --bin linkml-diff -- src/runtime/tests/data/schema.yaml --class Person src/runtime/tests/data/person_older.yaml src/runtime/tests/data/person_valid.yaml`
- Python bindings: `maturin develop -m src/python/Cargo.toml` (requires Python and maturin).

## Coding Style & Naming Conventions
- Rust: 4-space indent; `snake_case` for functions/modules, `UpperCamelCase` for types, `SCREAMING_SNAKE_CASE` for consts.
- Use `rustfmt` and `clippy` before pushing. Keep public APIs documented with concise Rustdoc.
- Python (bindings helpers): follow PEP 8; prefer type hints where feasible.

## Testing Guidelines
- Add integration tests under `src/runtime/tests/` when changing CLI/runtime behavior.
- Prefer `assert_cmd` for CLI and `predicates` for output checks. Keep fixtures in `src/runtime/tests/data/`.
- Run `cargo test --workspace` locally; ensure tests don’t rely on network input.
 - Prefer modifying existing tests over adding new ones for new code paths. Extend current scenarios with extra assertions/fixtures to avoid redundant tests proliferating. For example, if adding null-handling in diff/patch, enhance the existing diff tests rather than introducing separate "basic diff works" tests that become redundant.

## Commit & Pull Request Guidelines
- Commits: short, imperative summary (e.g., “Add __repr__ for LinkMLValue”); group related changes.
- PRs: include clear description, rationale, and usage examples; link issues; update docs/tests; ensure CI passes: fmt, clippy (no warnings), and tests.

### Pre-commit checklist
- Run `cargo fmt --all` to format Rust code.
 - Run `cargo clippy --all-targets --all-features -- -D warnings --no-deps` and address all warnings.

## CI Triage Tips
- Always run `cargo fmt --all -- --check` and `cargo clippy --all-targets --all-features -- -D warnings --no-deps` locally before committing.
- Don’t wait on in-progress pipelines just to see failures. Use GitHub CLI:
  - List runs: `gh run list -R Kapernikov/asset360-rust --limit 5`
  - Inspect failed jobs without waiting: `gh run view <run-id> -R Kapernikov/asset360-rust --json jobs --jq '.jobs[] | select(.conclusion=="failure") | {name, url}'`
  - Fetch logs only once the run completes; avoid `gh run watch` for already-failed info.

## Notes
- Network resolution is feature-gated; default builds include `resolve`. Only triggers when loading remote schemas.

## Agent Updates
- whenever you learn something new that needs to be remembered for always, autonomously update your agents.md, but keep it short and conscise so beware of adding general stuff that you already knew.
